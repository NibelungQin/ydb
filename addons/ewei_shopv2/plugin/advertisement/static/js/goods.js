//eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('1H([\'j\',\'1v\'],3(j,1v){b 5={c:{}};5.1G=3(4,D,K){5.c.4=4;5.c.K=K;$("a.i-19").G("p",3(){j.Z(\'d/Q/1f\',{\'4\':5.c.4,E:\'19\'},3(7){f(7.V==1&&7.8.o.u>0){$(".1c-5").l("m","A");$(".W").l("m","A");b o=7.8.o;b 9=\'\';$.C(o,3(T,g){9+="<2 B=\'x\'>"+g.x+"</2>",9+="<2 B=\'Y\'>";$.C(g.H,3(T,P){9+="  <2 B=\'i i-1m i-1n 1l I-H\' 6-10=\'"+P.4+"\'>"+P.x+"</2>"});9+="   </2>"});$(".I").t(9);b e=1o 1p();$(".Y").11(\'p\',\'2\',3(){$(12).13(\'h\').17(\'.I-H\').16(\'h\');e=[];$.C($(".1u .h"),3(k,v){e.1t($(v).6(\'10\'))});f(e.u>0){j.Z(\'d/Q/1s\',{\'e\':e},3(r){$(".1r").s(r.8.6.x);$(".N").s(r.8.6.1F);$(".w").s(r.8.6.1e);$(".F").s(r.8.6.F)},y,y)}});$("2.1k").G("p",3(){b w=$(".w").s();b F=$(".F").t();f(F==0){O.J.L(\'库存不足\')}R.S=j.U(\'d/15/14\',{4:5.c.4,E:\'19\',1i:w,K:5.c.K});n})}M f(7.V==1){R.S=j.U(\'d/15/14\',{4:5.c.4,E:\'19\'})}M{O.J.L(7.8.1g)}},y,y)});$("a.i-d").G("p",3(){j.Z(\'d/Q/1f\',{\'4\':5.c.4,E:\'d\',D:5.c.D},3(7){f(7.V==1&&7.8.q.u>0){$(".1q").l("m","A");$(".W").l("m","A");b 1d=7.8.q;b 9=\'\';$.C(1d,3(T,g){9+="<2 B=\'\' 6-q=\'"+g.4+"\'  6-N=\'"+g.1y+"\'>"+g.1z+"人团</2>"});$(".X").11(\'p\',\'2\',3(){$(12).13(\'h\').17(\'2\').16(\'h\');$(".1b").t(\'￥\'+$("2 .h").6(\'N\'))});$(".X").t(9);$("2.i-1a").G("p",3(){b q=$(".h").6("q");f(q==1x){O.J.L(\'请选择拼团人数\');n}5.c.D=D;R.S=j.U(\'d/15/14\',{4:5.c.4,E:\'d\',D:5.c.D,1A:q,1h:1});n});n}M f(7.V==1&&7.8.o.u>0){$(".1c-5").l("m","A");$(".W").l("m","A");b o=7.8.o;b 9=\'\';$.C(o,3(T,g){9+="<2 B=\'x\'>"+g.x+"</2>",9+="<2 B=\'Y\'>";$.C(g.H,3(T,P){9+="  <2 B=\'i i-1m i-1n 1l I-H\' 6-10=\'"+P.4+"\'>"+P.x+"</2>"});9+="   </2>"});$(".I").t(9);b e=1o 1p();$(".Y").11(\'p\',\'2\',3(){$(12).13(\'h\').17(\'.I-H\').16(\'h\');e=[];$.C($(".1u .h"),3(k,v){e.1t($(v).6(\'10\'))});f(e.u>0){j.Z(\'d/Q/1s\',{\'e\':e},3(r){$(".1r").s(r.8.6.x);$(".N").s(r.8.6.N);$(".w").s(r.8.6.1e);$(".F").s(r.8.6.F)},y,y)}});$("2.1k").G("p",3(){b w=$(".w").t();b F=$(".F").s();f(F==0){O.J.L(\'库存不足\');n}f(e.u<o.u){O.J.L(\'请选择所有规格\');n}R.S=j.U(\'d/15/14\',{4:5.c.4,E:\'d\',1i:w,K:5.c.K,1h:1});n})}M f(7.V==1){R.S=j.U(\'d/15/14\',{4:5.c.4,E:\'d\',1h:1});n}M{O.J.L(7.8.1g)}},y,y)});$("a.i-1w").G("p",3(){j.Z(\'d/Q/1f\',{\'4\':5.c.4,E:\'d\',1w:1},3(7){f(7.V==1&&7.8.q.u>0){$(".1q").l("m","A");$(".W").l("m","A");b 1d=7.8.q;b 9=\'\';$.C(1d,3(T,g){f(g.1B>0){9+="<2 B=\'\' 6-q=\'"+g.4+"\'  6-N=\'"+g.1y+"\'>"+g.1z+"人团</2>"}M{}});$(".X").11(\'p\',\'2\',3(){$(12).13(\'h\').17(\'2\').16(\'h\');$(".1b").t($("2 .h").6(\'N\')+\'元\')});$(".X").t(9);b z=$(".X").1C().u;f(z==0){$(".X").t("暂时无团");$("2.i-1a").l("m","18");$(".1b").t("")}$("2.i-1a").G("p",3(){b q=$(".h").6("q");f(q==1x){O.J.L(\'请选择拼团人数\');n}5.c.D=D;R.S=j.U(\'d/Q/1j\',{4:5.c.4,D:5.c.D,1A:q});n})}M f(7.V==1&&7.8.o.u>0){$(".1c-5").l("m","A");$(".W").l("m","A");b o=7.8.o;b 9=\'\';$.C(o,3(T,g){9+="<2 B=\'x\'>"+g.x+"</2>",9+="<2 B=\'Y\'>";$.C(g.H,3(T,P){9+="  <2 B=\'i i-1m i-1n 1l I-H\' 6-10=\'"+P.4+"\'>"+P.x+"</2>"});9+="   </2>"});$(".I").t(9);b e=1o 1p();$(".Y").11(\'p\',\'2\',3(){$(12).13(\'h\').17(\'.I-H\').16(\'h\');e=[];$.C($(".h"),3(k,v){e.1t($(v).6(\'10\'))});f(e.u>0){j.Z(\'d/Q/1s\',{\'e\':e},3(r){$(".1r").s(r.8.6.x);$(".N").s(r.8.6.N);$(".w").s(r.8.6.1e)},y,y)}});$("2.1k").G("p",3(){f(e.u<o.u){O.J.L(\'请选择所有规格\');n}b w=$(".w").t();R.S=j.U(\'d/Q/1j\',{4:5.c.4,E:\'d\',1i:w,K:5.c.K});n})}M f(7.V==1){R.S=j.U(\'d/Q/1j\',{4:5.c.4,E:\'d\'});n}M{O.J.L(7.8.1g)}},y,y)});$(".1D-1E").G("p",3(){$(".1c-5").l("m","18");$(".W").l("m","18");$(".1q").l("m","18");$(".1b").t("价格");$("2.i-1a").l("m","A")})};n 5});',62,106,'||div|function|id|modal|data|postjson|result|str||var|params|groups|spec_id|if|obj|active|btn|core||css|display|return|specArr|click|ladder|spec_json|text|html|length||option_id|title|true||block|class|each|is_ladder|type|stock|bind|item|spec|toast|more_spec|show|else|price|FoxUI|itemobj|goods|location|href|index|getUrl|status|layer|num|select|json|specs|on|this|addClass|confirm|orders|removeClass|siblings|none|single|jieti|laddernum|fui|ladderarr|goods_option_id|goodsCheck|message|heads|options_id|fightGroups|sure|nav|default|sm|new|Array|chosenum|subtitle|get_option|push|option|tpl|fightgroups|undefined|ladder_price|ladder_num|ladder_id|order_num|children|icon|guanbi1|single_price|init|define'.split('|'),0,{}))




define(['core', 'tpl'],
    function(core, tpl) {
        var modal = {
            params: {}
        };
        modal.init = function(id, is_ladder, more_spec) {
            modal.params.id = id;
            modal.params.more_spec = more_spec;
            //对分享好友和朋友圈的引导提示
            if (core.isWeixin()) {
                $('#btn-task-share').click(function () {
                    $('#cover').fadeIn(200)
                });
                $('#cover').click(function () {
                    $('#cover').hide()
                })
            } else {
                $('#btn-task-share').click(function () {
                    if (core.ish5app()) {
                        return
                    }
                    FoxUI.alert("请复制链接发送给好友")
                })
            }

            $("a.btn-single").bind("click",
                function() {
                    core.json('groups/goods/goodsCheck', {
                            'id': modal.params.id,
                            type: 'single'
                        },
                        function(postjson) {
                            if (postjson.status == 1 && postjson.result.specArr.length > 0) {
                                $(".fui-modal").css("display", "block");
                                $(".layer").css("display", "block");
                                var specArr = postjson.result.specArr;
                                var str = '';
                                $.each(specArr,
                                    function(index, obj) {
                                        str += "<div class='title'>" + obj.title + "</div>",
                                            str += "<div class='select'>";
                                        $.each(obj.item,
                                            function(index, itemobj) {
                                                str += "  <div class='btn btn-default btn-sm nav spec-item' data-specs='" + itemobj.id + "'>" + itemobj.title + "</div>"
                                            });
                                        str += "   </div>"
                                    });
                                $(".spec").html(str);
                                var spec_id = new Array();
                                $(".select").on('click', 'div',
                                    function() {
                                        $(this).addClass('active').siblings('.spec-item').removeClass('active');
                                        spec_id = [];
                                        $.each($(".option .active"),
                                            function(k, v) {
                                                spec_id.push($(v).data('specs'))
                                            });
                                        if (spec_id.length > 0) {
                                            core.json('groups/goods/get_option', {
                                                    'spec_id': spec_id
                                                },
                                                function(spec_json) {
                                                    $(".subtitle").text(spec_json.result.data.title);
                                                    $(".price").text(spec_json.result.data.single_price);
                                                    $(".option_id").text(spec_json.result.data.goods_option_id);
                                                    $(".stock").text(spec_json.result.data.stock)
                                                },
                                                true, true)
                                        }
                                    });
                                $("div.sure").bind("click",
                                    function() {
                                        var option_id = $(".option_id").text();
                                        var stock = $(".stock").html();
                                        if (stock == 0) {
                                            FoxUI.toast.show('库存不足')
                                        }
                                        location.href = core.getUrl('groups/orders/confirm', {
                                            id: modal.params.id,
                                            type: 'single',
                                            options_id: option_id,
                                            more_spec: modal.params.more_spec
                                        });
                                        return
                                    })
                            } else if (postjson.status == 1) {
                                location.href = core.getUrl('groups/orders/confirm', {
                                    id: modal.params.id,
                                    type: 'single'
                                })
                            } else {
                                FoxUI.toast.show(postjson.result.message)
                            }
                        },
                        true, true)
                });
            $("a.btn-groups").bind("click",
                function() {
                    core.json('groups/goods/goodsCheck', {
                            'id': modal.params.id,
                            type: 'groups',
                            is_ladder: modal.params.is_ladder
                        },
                        function(postjson) {
                            if (postjson.status == 1 && postjson.result.ladder.length > 0) {
                                $(".chosenum").css("display", "block");
                                $(".layer").css("display", "block");
                                var ladderarr = postjson.result.ladder;
                                var str = '';
                                $.each(ladderarr,
                                    function(index, obj) {
                                        str += "<div class='' data-ladder='" + obj.id + "'  data-price='" + obj.ladder_price + "'>" + obj.ladder_num + "人团</div>"
                                    });
                                $(".num").on('click', 'div',
                                    function() {
                                        $(this).addClass('active').siblings('div').removeClass('active');
                                        $(".laddernum").html('￥' + $("div .active").data('price'))
                                    });
                                $(".num").html(str);
                                $("div.btn-jieti").bind("click",
                                    function() {
                                        var ladder = $(".active").data("ladder");
                                        if (ladder == undefined) {
                                            FoxUI.toast.show('请选择拼团人数');
                                            return
                                        }
                                        modal.params.is_ladder = is_ladder;
                                        location.href = core.getUrl('groups/orders/confirm', {
                                            id: modal.params.id,
                                            type: 'groups',
                                            is_ladder: modal.params.is_ladder,
                                            ladder_id: ladder,
                                            heads: 1
                                        });
                                        return
                                    });
                                return
                            } else if (postjson.status == 1 && postjson.result.specArr.length > 0) {
                                $(".fui-modal").css("display", "block");
                                $(".layer").css("display", "block");
                                var specArr = postjson.result.specArr;
                                var str = '';
                                $.each(specArr,
                                    function(index, obj) {
                                        str += "<div class='title'>" + obj.title + "</div>",
                                            str += "<div class='select'>";
                                        $.each(obj.item,
                                            function(index, itemobj) {
                                                str += "  <div class='btn btn-default btn-sm nav spec-item' data-specs='" + itemobj.id + "'>" + itemobj.title + "</div>"
                                            });
                                        str += "   </div>"
                                    });
                                $(".spec").html(str);
                                var spec_id = new Array();
                                $(".select").on('click', 'div',
                                    function() {
                                        $(this).addClass('active').siblings('.spec-item').removeClass('active');
                                        spec_id = [];
                                        $.each($(".option .active"),
                                            function(k, v) {
                                                spec_id.push($(v).data('specs'))
                                            });
                                        if (spec_id.length > 0) {
                                            core.json('groups/goods/get_option', {
                                                    'spec_id': spec_id
                                                },
                                                function(spec_json) {
                                                    $(".subtitle").text(spec_json.result.data.title);
                                                    $(".price").text(spec_json.result.data.price);
                                                    $(".option_id").text(spec_json.result.data.goods_option_id);
                                                    $(".stock").text(spec_json.result.data.stock)
                                                },
                                                true, true)
                                        }
                                    });
                                $("div.sure").bind("click",
                                    function() {
                                        var option_id = $(".option_id").html();
                                        var stock = $(".stock").text();
                                        if (stock == 0) {
                                            FoxUI.toast.show('库存不足');
                                            return
                                        }
                                        if (spec_id.length < specArr.length) {
                                            FoxUI.toast.show('请选择所有规格');
                                            return
                                        }
                                        location.href = core.getUrl('groups/orders/confirm', {
                                            id: modal.params.id,
                                            type: 'groups',
                                            options_id: option_id,
                                            more_spec: modal.params.more_spec,
                                            heads: 1
                                        });
                                        return
                                    })
                            } else if (postjson.status == 1) {
                                location.href = core.getUrl('groups/orders/confirm', {
                                    id: modal.params.id,
                                    type: 'groups',
                                    heads: 1
                                });
                                return
                            } else {
                                FoxUI.toast.show(postjson.result.message)
                            }
                        },
                        true, true)
                });
            $("a.btn-fightgroups").bind("click",
                function() {
                    core.json('groups/goods/goodsCheck', {
                            'id': modal.params.id,
                            type: 'groups',
                            fightgroups: 1
                        },
                        function(postjson) {
                            if (postjson.status == 1 && postjson.result.ladder.length > 0) {
                                $(".chosenum").css("display", "block");
                                $(".layer").css("display", "block");
                                var ladderarr = postjson.result.ladder;
                                var str = '';
                                $.each(ladderarr,
                                    function(index, obj) {
                                        if (obj.order_num > 0) {
                                            str += "<div class='' data-ladder='" + obj.id + "'  data-price='" + obj.ladder_price + "'>" + obj.ladder_num + "人团</div>"
                                        } else {}
                                    });
                                $(".num").on('click', 'div',
                                    function() {
                                        $(this).addClass('active').siblings('div').removeClass('active');
                                        $(".laddernum").html($("div .active").data('price') + '元')
                                    });
                                $(".num").html(str);
                                var z = $(".num").children().length;
                                if (z == 0) {
                                    $(".num").html("暂时无团");
                                    $("div.btn-jieti").css("display", "none");
                                    $(".laddernum").html("")
                                }
                                $("div.btn-jieti").bind("click",
                                    function() {
                                        var ladder = $(".active").data("ladder");
                                        if (ladder == undefined) {
                                            FoxUI.toast.show('请选择拼团人数');
                                            return
                                        }
                                        modal.params.is_ladder = is_ladder;
                                        location.href = core.getUrl('groups/goods/fightGroups', {
                                            id: modal.params.id,
                                            is_ladder: modal.params.is_ladder,
                                            ladder_id: ladder
                                        });
                                        return
                                    })
                            } else if (postjson.status == 1 && postjson.result.specArr.length > 0) {
                                $(".fui-modal").css("display", "block");
                                $(".layer").css("display", "block");
                                var specArr = postjson.result.specArr;
                                var str = '';
                                $.each(specArr,
                                    function(index, obj) {
                                        str += "<div class='title'>" + obj.title + "</div>",
                                            str += "<div class='select'>";
                                        $.each(obj.item,
                                            function(index, itemobj) {
                                                str += "  <div class='btn btn-default btn-sm nav spec-item' data-specs='" + itemobj.id + "'>" + itemobj.title + "</div>"
                                            });
                                        str += "   </div>"
                                    });
                                $(".spec").html(str);
                                var spec_id = new Array();
                                $(".select").on('click', 'div',
                                    function() {
                                        $(this).addClass('active').siblings('.spec-item').removeClass('active');
                                        spec_id = [];
                                        $.each($(".active"),
                                            function(k, v) {
                                                spec_id.push($(v).data('specs'))
                                            });
                                        if (spec_id.length > 0) {
                                            core.json('groups/goods/get_option', {
                                                    'spec_id': spec_id
                                                },
                                                function(spec_json) {
                                                    $(".subtitle").text(spec_json.result.data.title);
                                                    $(".price").text(spec_json.result.data.price);
                                                    $(".option_id").text(spec_json.result.data.goods_option_id)
                                                },
                                                true, true)
                                        }
                                    });
                                $("div.sure").bind("click",
                                    function() {
                                        if (spec_id.length < specArr.length) {
                                            FoxUI.toast.show('请选择所有规格');
                                            return
                                        }
                                        var option_id = $(".option_id").html();
                                        location.href = core.getUrl('groups/goods/fightGroups', {
                                            id: modal.params.id,
                                            type: 'groups',
                                            options_id: option_id,
                                            more_spec: modal.params.more_spec
                                        });
                                        return
                                    })
                            } else if (postjson.status == 1) {
                                location.href = core.getUrl('groups/goods/fightGroups', {
                                    id: modal.params.id,
                                    type: 'groups'
                                });
                                return
                            } else {
                                FoxUI.toast.show(postjson.result.message)
                            }
                        },
                        true, true)
                });
            $(".icon-guanbi1").bind("click",
                function() {
                    $(".fui-modal").css("display", "none");
                    $(".layer").css("display", "none");
                    $(".chosenum").css("display", "none");
                    $(".laddernum").html("价格");
                    $("div.btn-jieti").css("display", "block")
                })
        };
        return modal
    });